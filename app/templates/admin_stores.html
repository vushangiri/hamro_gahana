{% extends "base.html" %}
{% block content %}

<div class="card rounded-3 border-0 shadow p-4">
  <h6 class="section-header mb-3 mt-2">All Stores</h6>
  <div class="d-flex justify-content-between align-items-center mb-3">
  <form method="get" class="d-flex gap-2">
    <input
      type="text"
      name="q"
      value="{{ search }}"
      class="form-control"
      placeholder="Search stores or products..."
    >
    <button type="submit" class="btn btn-app fw-bold">
      Search
    </button>
  </form>
</div>
  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Store Name</th>
          <th>Owner Phone</th>
          <th>Address</th>
          <th>Products</th>
        </tr>
      </thead>
      <tbody>
        {% for store in stores %}
        <tr>
          <td>{{ store.store_name }}</td>
          <td>{{ store.owner.phone }}</td>
          <td>{{ store.store_address }}</td>
          <td>
            {% if store.products %}
            <a href="{{ url_for('admin.store_products', store_id=store.id) }}" class="btn btn-sm btn-light-2">
              <i class="bi bi-box-seam"></i> View Products ({{ store.products|length }})
            </a>
              <!-- Button trigger modal -->
              <!-- <button type="button" class="btn btn-sm btn-app" data-bs-toggle="modal" data-bs-target="#productsModal{{ store.id }}">
                View Products ({{ store.products|length }})
              </button> -->

              <!-- Modal -->
              <!-- <div class="modal fade" id="productsModal{{ store.id }}" tabindex="-1" aria-labelledby="productsModalLabel{{ store.id }}" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="productsModalLabel{{ store.id }}">Products - {{ store.store_name }}</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <ul class="list-group">
                        {% for product in store.products %}
                        <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
                          <span>
                            <strong>{{ product.name }}</strong>
                            <span class="badge bg-{% if product.status == 'published' %}success{% else %}warning text-dark{% endif %}">
                              {{ product.status|capitalize }}
                            </span>
                          </span>
                          <form method="post" action="{{ url_for('admin.change_status', id=product.id) }}" class="d-flex align-items-center gap-1">
                            <select name="status" class="form-select form-select-sm">
                              <option value="published" {% if product.status == 'published' %}selected{% endif %}>Published</option>
                              <option value="hold" {% if product.status == 'hold' %}selected{% endif %}>Hold</option>
                            </select>
                            <button type="submit" class="btn btn-sm btn-app">Update</button>
                          </form>
                        </li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>
              </div> -->
            {% else %}
              <span class="text-muted">No products</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-between mt-3">
    {% if pagination.has_prev %}
      <a href="{{ url_for('admin.admin_stores', page=pagination.prev_num) }}" class="btn btn-outline-secondary">&laquo; Previous</a>
    {% else %}
      <span></span>
    {% endif %}

    {% if pagination.has_next %}
      <a href="{{ url_for('admin.admin_stores', page=pagination.next_num) }}" class="btn btn-outline-secondary">Next &raquo;</a>
    {% else %}
      <span></span>
    {% endif %}
  </div>
</div>

{% endblock %}
